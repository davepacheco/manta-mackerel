[
    {
        "disabled": false,
        "category": "mackerel",
        "name": "storage",
        "start_at": "1970-01-01T00:00:00.000Z",
        "data_delay": 29700,
        "frequency": "daily",
        "output_file": "/{{ADMIN_USERNAME}}/stor/usage/storage/%y/%m/%d/%H/h%H.json",
        "input_pattern": [
            {{#INDEX_MORAY_SHARDS}}
                "/{{ADMIN_USERNAME}}/stor/manatee_backups/{{host}}/%y/%m/%d/%H/manta-*.gz"{{^last}},{{/last}}
            {{/INDEX_MORAY_SHARDS}}
        ],
        "input_style": [
            "all_matches"
        ],
        "user": "{{ADMIN_USERNAME}}",
        "mapMemory": {{#METERING_STORAGE_MAP_MEMORY}}{{METERING_STORAGE_MAP_MEMORY}}{{/METERING_STORAGE_MAP_MEMORY}}{{^METERING_STORAGE_MAP_MEMORY}}2048{{/METERING_STORAGE_MAP_MEMORY}},
        "mapDisk": {{#METERING_STORAGE_MAP_DISK}}{{METERING_STORAGE_MAP_DISK}}{{/METERING_STORAGE_MAP_DISK}}{{^METERING_STORAGE_MAP_DISK}}128{{/METERING_STORAGE_MAP_DISK}},
        "reduce1Memory": {{#METERING_STORAGE_REDUCE1_MEMORY}}{{METERING_STORAGE_REDUCE1_MEMORY}}{{/METERING_STORAGE_REDUCE1_MEMORY}}{{^METERING_STORAGE_REDUCE1_MEMORY}}2048{{/METERING_STORAGE_REDUCE1_MEMORY}},
        "reduce1Disk": {{#METERING_STORAGE_REDUCE1_DISK}}{{METERING_STORAGE_REDUCE1_DISK}}{{/METERING_STORAGE_REDUCE1_DISK}}{{^METERING_STORAGE_REDUCE1_DISK}}8{{/METERING_STORAGE_REDUCE1_DISK}},
        "reduce1Count": {{#METERING_STORAGE_REDUCE1_COUNT}}{{METERING_STORAGE_REDUCE1_COUNT}}{{/METERING_STORAGE_REDUCE1_COUNT}}{{^METERING_STORAGE_REDUCE1_COUNT}}11{{/METERING_STORAGE_REDUCE1_COUNT}},
        "reduce2Memory": {{#METERING_STORAGE_REDUCE2_MEMORY}}{{METERING_STORAGE_REDUCE2_MEMORY}}{{/METERING_STORAGE_REDUCE2_MEMORY}}{{^METERING_STORAGE_REDUCE2_MEMORY}}1024{{/METERING_STORAGE_REDUCE2_MEMORY}},
        "reduce2Disk": {{#METERING_STORAGE_REDUCE2_DISK}}{{METERING_STORAGE_REDUCE2_DISK}}{{/METERING_STORAGE_REDUCE2_DISK}}{{^METERING_STORAGE_REDUCE2_DISK}}8{{/METERING_STORAGE_REDUCE2_DISK}},
        "reduce2Count": {{#METERING_STORAGE_REDUCE2_COUNT}}{{METERING_STORAGE_REDUCE2_COUNT}}{{/METERING_STORAGE_REDUCE2_COUNT}}{{^METERING_STORAGE_REDUCE2_COUNT}}11{{/METERING_STORAGE_REDUCE2_COUNT}}
        "env": {
            "ADMIN_USER": "{{ADMIN_USERNAME}},
            "EXCLUDE_UNAPPROVED_USERS": 0,
            "DATE": "%y-%m-%dT%H:00:00.000Z",
            "DELIVER_UNAPPROVED_REPORTS": 0,
            "MIN_SIZE": 131072,
            "NAMESPACES": "stor public jobs reports",
            "USER_DEST": "/reports/usage/storage/%y/%m/%d/%H/h%H.json",
            "USER_LINK": "/reports/usage/storage/latest",
            "ZCAT": "gzcat -f"
        }
    },


    {
        "disabled": false,
        "category": "mackerel",
        "name": "request",
        "start_at": "1970-01-01T00:00:00.000Z",
        "data_delay": 600,
        "frequency": "hourly",
        "output_file": "/{{ADMIN_USERNAME}}/stor/usage/request/%y/%m/%d/%H/h%H.json",
        "input_pattern": "/{{ADMIN_USERNAME}}/stor/logs/muskie/%y/%m/%d/%H/*.log",
        "input_style": [
            "all_matches"
        ],
        "user": "{{ADMIN_USERNAME}}",
        "mapMemory":{{#METERING_REQUEST_MAP_MEMORY}}{{METERING_REQUEST_MAP_MEMORY}}{{/METERING_REQUEST_MAP_MEMORY}}{{^METERING_REQUEST_MAP_MEMORY}}1024{{/METERING_REQUEST_MAP_MEMORY}},
        "mapDisk":{{#METERING_REQUEST_MAP_DISK}}{{METERING_REQUEST_MAP_DISK}}{{/METERING_REQUEST_MAP_DISK}}{{^METERING_REQUEST_MAP_DISK}}8{{/METERING_REQUEST_MAP_DISK}},
        "reduce1Memory":{{#METERING_REQUEST_REDUCE_MEMORY}}{{METERING_REQUEST_REDUCE_MEMORY}}{{/METERING_REQUEST_REDUCE_MEMORY}}{{^METERING_REQUEST_REDUCE_MEMORY}}1024{{/METERING_REQUEST_REDUCE_MEMORY}},
        "reduce1Disk":{{#METERING_REQUEST_REDUCE_DISK}}{{METERING_REQUEST_REDUCE_DISK}}{{/METERING_REQUEST_REDUCE_DISK}}{{^METERING_REQUEST_REDUCE_DISK}}8{{/METERING_REQUEST_REDUCE_DISK}},
        "reduce1Count": {{#METERING_REQUEST_REDUCE_COUNT}}{{METERING_REQUEST_REDUCE_COUNT}}{{/METERING_REQUEST_REDUCE_COUNT}}{{^METERING_REQUEST_REDUCE_COUNT}}11{{/METERING_REQUEST_REDUCE_COUNT}},
        "env": {
            "EXCLUDE_UNAPPROVED_USERS": 0,
            "DATE": "%y-%m-%dT%H:00:00.000Z",
            "DELIVER_UNAPPROVED_REPORTS": 0,
            "INCLUDE_ADMIN_REQUESTS": 0,
            "MALFORMED_LIMIT": 10,
            "USER_DEST": "/reports/usage/request/%y/%m/%d/%H/h%H.json",
            "USER_LINK": "/reports/usage/request/latest"
        }
    },


    {
        "disabled": false,
        "category": "mackerel",
        "name": "compute",
        "start_at": "1970-01-01T00:00:00.000Z",
        "data_delay": 600,
        "frequency": "hourly",
        "output_file": "/{{ADMIN_USERNAME}}/stor/usage/compute/%y/%m/%d/%H/h%H.json",
        "input_pattern": "/{{ADMIN_USERNAME}}/stor/logs/marlin-agent/%y/%m/%d/%H/*.log",
        "input_style": [
            "all_matches"
        ],
        "user": "{{ADMIN_USERNAME}}",
        "mapMemory":{{#METERING_COMPUTE_MAP_MEMORY}}{{METERING_COMPUTE_MAP_MEMORY}}{{/METERING_COMPUTE_MAP_MEMORY}}{{^METERING_COMPUTE_MAP_MEMORY}}1024{{/METERING_COMPUTE_MAP_MEMORY}},
        "mapDisk":{{#METERING_COMPUTE_MAP_DISK}}{{METERING_COMPUTE_MAP_DISK}}{{/METERING_COMPUTE_MAP_DISK}}{{^METERING_COMPUTE_MAP_DISK}}8{{/METERING_COMPUTE_MAP_DISK}},
        "reduce1Memory":{{#METERING_COMPUTE_REDUCE_MEMORY}}{{METERING_COMPUTE_REDUCE_MEMORY}}{{/METERING_COMPUTE_REDUCE_MEMORY}}{{^METERING_COMPUTE_REDUCE_MEMORY}}1024{{/METERING_COMPUTE_REDUCE_MEMORY}},
        "reduce1Disk":{{#METERING_COMPUTE_REDUCE_DISK}}{{METERING_COMPUTE_REDUCE_DISK}}{{/METERING_COMPUTE_REDUCE_DISK}}{{^METERING_COMPUTE_REDUCE_DISK}}8{{/METERING_COMPUTE_REDUCE_DISK}},
        "reduce1Count": {{#METERING_COMPUTE_REDUCE_COUNT}}{{METERING_COMPUTE_REDUCE_COUNT}}{{/METERING_COMPUTE_REDUCE_COUNT}}{{^METERING_COMPUTE_REDUCE_COUNT}}11{{/METERING_COMPUTE_REDUCE_COUNT}},
        "env": {
            "EXCLUDE_UNAPPROVED_USERS": 0,
            "DATE": "%y-%m-%dT%H:00:00.000Z",
            "DELIVER_UNAPPROVED_REPORTS": 0,
            "MALFORMED_LIMIT": 10,
            "USER_DEST": "/reports/usage/compute/%y/%m/%d/%H/h%H.json",
            "USER_LINK": "/reports/usage/compute/latest"
        }
    },


    {
        "disabled": false,
        "category": "mackerel",
        "name": "access-logs",
        "start_at": "1970-01-01T00:00:00.000Z",
        "data_delay": 600,
        "frequency": "hourly",
        "output_file": "/{{ADMIN_USERNAME}}/stor/usage/access-logs/%y/%m/%d/%H/done",
        "input_pattern": "/{{ADMIN_USERNAME}}/stor/logs/muskie/%y/%m/%d/%H/*.log",
        "input_style": [
            "all_matches"
        ],
        "user": "{{ADMIN_USERNAME}}",
        "mapMemory":{{#METERING_ACCESSLOGS_MAP_MEMORY}}{{METERING_ACCESSLOGS_MAP_MEMORY}}{{/METERING_ACCESSLOGS_MAP_MEMORY}}{{^METERING_ACCESSLOGS_MAP_MEMORY}}1024{{/METERING_ACCESSLOGS_MAP_MEMORY}},
        "mapDisk":{{#METERING_ACCESSLOGS_MAP_DISK}}{{METERING_ACCESSLOGS_MAP_DISK}}{{/METERING_ACCESSLOGS_MAP_DISK}}{{^METERING_ACCESSLOGS_MAP_DISK}}8{{/METERING_ACCESSLOGS_MAP_DISK}},
        "reduce1Memory":{{#METERING_ACCESSLOGS_REDUCE_MEMORY}}{{METERING_ACCESSLOGS_REDUCE_MEMORY}}{{/METERING_ACCESSLOGS_REDUCE_MEMORY}}{{^METERING_ACCESSLOGS_REDUCE_MEMORY}}1024{{/METERING_ACCESSLOGS_REDUCE_MEMORY}},
        "reduce1Disk":{{#METERING_ACCESSLOGS_REDUCE_DISK}}{{METERING_ACCESSLOGS_REDUCE_DISK}}{{/METERING_ACCESSLOGS_REDUCE_DISK}}{{^METERING_ACCESSLOGS_REDUCE_DISK}}8{{/METERING_ACCESSLOGS_REDUCE_DISK}},
        "reduce1Count": {{#METERING_ACCESSLOGS_REDUCE_COUNT}}{{METERING_ACCESSLOGS_REDUCE_COUNT}}{{/METERING_ACCESSLOGS_REDUCE_COUNT}}{{^METERING_ACCESSLOGS_REDUCE_COUNT}}11{{/METERING_ACCESSLOGS_REDUCE_COUNT}},
        "env": {
            "ACCESS_DEST": "/reports/access-logs/%y/%m/%d/%H/h%H.json",
            "ACCESS_LINK": "/reports/access-logs/latest",
            "EXCLUDE_UNAPPROVED_USERS": 0,
            "MALFORMED_LIMIT": "10",
            "INCLUDE_ADMIN_REQUESTS": 0
        }
    },


    {
        "disabled": false,
        "category": "mackerel",
        "name": "summary",
        "start_at": "1970-01-01T00:00:00.000Z",
        "data_delay": 108000,
        "frequency": "daily",
        "output_file": "/{{ADMIN_USERNAME}}/stor/usage/summary/%y/%m/%d/d%d.json",
        "input_pattern": [
            "/{{ADMIN_USERNAME}}/stor/usage/storage/%y/%m/%d",
            "/{{ADMIN_USERNAME}}/stor/usage/request/%y/%m/%d",
            "/{{ADMIN_USERNAME}}/stor/usage/compute/%y/%m/%d"
        ],
        "input_style": [
            "daily_each_hour",
            "single_file"
        ],
        "mapMemory":{{#METERING_ACCESSLOGS_MAP_MEMORY}}{{METERING_ACCESSLOGS_MAP_MEMORY}}{{/METERING_ACCESSLOGS_MAP_MEMORY}}{{^METERING_ACCESSLOGS_MAP_MEMORY}}1024{{/METERING_ACCESSLOGS_MAP_MEMORY}},
        "mapDisk":{{#METERING_ACCESSLOGS_MAP_DISK}}{{METERING_ACCESSLOGS_MAP_DISK}}{{/METERING_ACCESSLOGS_MAP_DISK}}{{^METERING_ACCESSLOGS_MAP_DISK}}8{{/METERING_ACCESSLOGS_MAP_DISK}},
        "reduce1Memory":{{#METERING_ACCESSLOGS_REDUCE_MEMORY}}{{METERING_ACCESSLOGS_REDUCE_MEMORY}}{{/METERING_ACCESSLOGS_REDUCE_MEMORY}}{{^METERING_ACCESSLOGS_REDUCE_MEMORY}}1024{{/METERING_ACCESSLOGS_REDUCE_MEMORY}},
        "reduce1Disk":{{#METERING_ACCESSLOGS_REDUCE_DISK}}{{METERING_ACCESSLOGS_REDUCE_DISK}}{{/METERING_ACCESSLOGS_REDUCE_DISK}}{{^METERING_ACCESSLOGS_REDUCE_DISK}}8{{/METERING_ACCESSLOGS_REDUCE_DISK}},
        "reduce1Count": {{#METERING_ACCESSLOGS_REDUCE_COUNT}}{{METERING_ACCESSLOGS_REDUCE_COUNT}}{{/METERING_ACCESSLOGS_REDUCE_COUNT}}{{^METERING_ACCESSLOGS_REDUCE_COUNT}}11{{/METERING_ACCESSLOGS_REDUCE_COUNT}},
        "env": {
            "EXCLUDE_UNAPPROVED_USERS": 0,
            "DATE": "%y-%m-%dT%H:00:00.000Z",
            "DELIVER_UNAPPROVED_REPORTS": 0,
            "USER_DEST": "/reports/usage/summary/%y/%m/%d/d%d.json",
            "USER_LINK": "/reports/usage/summary/latest"
        }
    }
]
